version: 2
jobs:
  build:
    docker:
     - image: circleci/ruby:2.5.0-node-browsers
       enviroment:
         PGHOST: 127.0.0.1
         PGUSER: rails_api-react_client
         RAILS_ENV: test
     - image: circleci/postgres:9.6-alpine
       environment:
        POSTGRES_USER: rails_api-react_client
        POSTGRES_DB: rails_api-react_client_production

    working_directory: /home/Project/rails_api
    steps:
      - checkout
      - run: apt-get update -qq && apt-get install -y build-essential nodejs
      - run: bundle install
      - run: bundle exec rake db:create db:schema:load --trace
      - run: bundle exec rake db:migrate
      - run: bundle exec rspec spec
